(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4099],{2950:(e,n,t)=>{"use strict";t.r(n),t.d(n,{contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var i=t(87462),a=(t(67294),t(3905));t(78561);const r={title:"Access Control Permissions",sidebar_position:13},s=void 0,o={unversionedId:"concepts/designing-permissions",id:"concepts/designing-permissions",isDocsHomePage:!1,title:"Access Control Permissions",description:"You can describe permissions attributed using a JSON",source:"@site/docs/common/concepts/designing-permissions.mdx",sourceDirName:"concepts",slug:"/concepts/designing-permissions",permalink:"/common/concepts/designing-permissions",editUrl:"https://github.com/getditto/docs/edit/main/docs/common/concepts/designing-permissions.mdx",tags:[],version:"current",sidebarPosition:13,frontMatter:{title:"Access Control Permissions",sidebar_position:13},sidebar:"defaultSidebar",previous:{title:"Removing",permalink:"/common/concepts/remove"},next:{title:"Overview",permalink:"/common/mesh-network/supported-transports"}},l=[{value:"Rejecting a user",id:"rejecting-a-user",children:[],level:2},{value:"Accepting a user",id:"accepting-a-user",children:[],level:2},{value:"Access Control Permissions",id:"access-control-permissions",children:[{value:"Example",id:"example",children:[],level:3}],level:2},{value:"App-level Security",id:"app-level-security",children:[],level:2}],c={toc:l};function d(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,i.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"You can describe permissions attributed using a JSON\ndocument. This JSON document is encoded within the certificate used by each\ndevice. Each peer verifies the cerificates of other peers, and accepts or rejects reads\nand writes based on these permissions."),(0,a.kt)("p",null,"You can issue each certificiate ",(0,a.kt)("a",{parentName:"p",href:"../how-it-works/certificate-security"},"manually")," or with the ",(0,a.kt)("a",{parentName:"p",href:"../security/authentication/overview"},"Online with\nAuthentication identity"),". "),(0,a.kt)("h2",{id:"rejecting-a-user"},"Rejecting a user"),(0,a.kt)("p",null,"To reject a user from reading or writing at all, specify the JSON payload below."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsonc"},'{\n  "authenticate": false\n}\n')),(0,a.kt)("h2",{id:"accepting-a-user"},"Accepting a user"),(0,a.kt)("p",null,"To grant full ",(0,a.kt)("inlineCode",{parentName:"p"},"read")," & ",(0,a.kt)("inlineCode",{parentName:"p"},"write")," permissions to ",(0,a.kt)("em",{parentName:"p"},"all collections")," and ",(0,a.kt)("em",{parentName:"p"},"all documents"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsonc"},'{\n  "authenticate": true,\n  "expirationSeconds": 28800,\n  "userID": "123abc",\n  "permissions": {\n    "read": {\n      "everything": true,\n      "queriesByCollection": {}\n    },\n    "write": {\n      "everything": true,\n      "queriesByCollection": {}\n    }\n  }\n}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"authenticate")," to ",(0,a.kt)("inlineCode",{parentName:"li"},"true")," to tell the webhook that the user has successfully validated"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"expirationSeconds")," is ",(0,a.kt)("inlineCode",{parentName:"li"},"number")," property on how long the authentication session is valid for before a refresh is required."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"userID")," is a ",(0,a.kt)("inlineCode",{parentName:"li"},"string")," which identifies the the ",(0,a.kt)("inlineCode",{parentName:"li"},"userID"),". This should be ",(0,a.kt)("em",{parentName:"li"},"unique")," across users within your app. "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"permissions")," which describes all the types of access control for collections and documents that this user can ",(0,a.kt)("inlineCode",{parentName:"li"},"read")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"write"))),(0,a.kt)("h2",{id:"access-control-permissions"},"Access Control Permissions"),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Currently, you can ",(0,a.kt)("strong",{parentName:"p"},"only specify a permission query on the ",(0,a.kt)("inlineCode",{parentName:"strong"},"_id")," field of a\ndocument"),". Mutable properties are currently not supported. We are working on\nadding this feature.  "))),(0,a.kt)("p",null,"To grant selective permissions on specific documents, add to the\n",(0,a.kt)("inlineCode",{parentName:"p"},"queriesByCollection")," property inside either the ",(0,a.kt)("inlineCode",{parentName:"p"},"read")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"write")," property.\nEach key inside ",(0,a.kt)("inlineCode",{parentName:"p"},"queriesByCollection")," is a reference to the collection. Each\nvalue is an array of ",(0,a.kt)("a",{parentName:"p",href:"../concepts/querying"},"ditto queries")," describing which\ndocuments the user can read or write."),(0,a.kt)("h3",{id:"example"},"Example"),(0,a.kt)("p",null,"The following write permissions below describe that ",(0,a.kt)("inlineCode",{parentName:"p"},'userID: "123abc"')," can"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"write")," to documents in the ",(0,a.kt)("inlineCode",{parentName:"li"},'"books"')," collection where the ",(0,a.kt)("inlineCode",{parentName:"li"},"_id.title")," value ",(0,a.kt)("inlineCode",{parentName:"li"},"endsWith('Potter')"),"."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"write")," to any document in the ",(0,a.kt)("inlineCode",{parentName:"li"},'"newspapers"')," collection. We use a single value of ",(0,a.kt)("inlineCode",{parentName:"li"},"true")," "),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"read")," to documents in the ",(0,a.kt)("inlineCode",{parentName:"li"},'"books"')," collection where the ",(0,a.kt)("inlineCode",{parentName:"li"},"_id.title")," value ",(0,a.kt)("inlineCode",{parentName:"li"},"endsWith('Potter')"),".")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsonc"},'{\n  "authenticate": true,\n  "expirationSeconds": 28800,\n  "userID": "123abc",\n  "permissions": {\n    "write": {\n      "everything": false, // ensure that this is false\n      "queriesByCollection": {\n        // highlight-start\n        // 1. \n        "books": [\n          "endsWith(_id.title, \'Potter\')"\n        ],\n        // highlight-end\n        \n        // highlight-start\n        // 2. \n        "newspapers": [\n          "true"\n        ]\n        // highlight-end\n      }\n    },\n    "read": {\n      "everything": false, // ensure that this is false\n      "queriesByCollection": {\n        // highlight-start\n        // 3.\n        "books": [\n          "endsWith(_id.title, \'Potter\')"\n        ],\n        // highlight-end\n      }\n    }\n  }\n}\n')),(0,a.kt)("p",null,"Here is a full example for a complex permissions query: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsonc"},'{\n  "authenticate": true,\n  "identity": {\n      "provider": "facebook",\n      "id": true\n  },\n  "expirationSeconds": 3600,\n  "permissions": {\n      "read": {\n          "everything": false,\n          "queriesByCollection": {\n              "cars": ["_id == \'my-specific-id\'", "_id == \'id1\' || _id == \'id2"],\n              "boats": ["_id > 100", "_id > -10 && _id < 10"],\n              "foods": ["_id == false"],\n              "books": ["endsWith(_id, \'Potter\')"]\n          }\n      },\n      "write": {\n          "everything": false,\n          "queriesByCollection": {\n              "cars": ["_id.price > 1500 && _id.currency == \'USD\'", "_id.color == \'red"],\n              "boats": ["regex(_id, \'^Wave.*\')"]\n          }\n      },\n  }\n}\n')),(0,a.kt)("h2",{id:"app-level-security"},"App-level Security"),(0,a.kt)("p",null,"The access rules contained in the identity are rigid, signed by the central\ncertificate authority, and enforced by all participating devices. This offers\nthe highest level of security. If a device is not allowed to access particular\ndata, it will never be synced to their device. See ",(0,a.kt)("a",{parentName:"p",href:"../mesh-network/query-overlap-groups"},"Query Overlap\nGroups"),", for more details on multi-hopping\nthrough untrusted devices."),(0,a.kt)("p",null,"For apps with weaker security requirements, a developer may choose to relax the\naccess rules inside the Ditto certificate, and instead restrict access in their application code."),(0,a.kt)("p",null,"One advantage is that the developer has more flexibility to change the access\nrules dynamically since they are not encoded in signed certificates. Another\nadvantage is that all devices in the mesh can participate in syncing the data,\nwhich may help it propagate faster. If certain data is only accessible to a few\nprivileged devices which are not often in range of each other, it will take\nlonger for them to sync."),(0,a.kt)("p",null,"The disadvantage is that an unprivileged user does have a device containing\nprivileged data. A technically savvy user or phone thief may be able to gain\naccess to not only their regular data, but also the more privileged data that\nthey were never intended to be able to view."),(0,a.kt)("p",null,"Therefore relaxed access rules - app-level security - are only suitable for\nenvironments where there is a degree of trust that the devices won't end up\nunlocked in the wrong hands."))}d.isMDXComponent=!0},11748:(e,n,t)=>{var i={"./locale":89234,"./locale.js":89234};function a(e){var n=r(e);return t(n)}function r(e){if(!t.o(i,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id=11748}}]);
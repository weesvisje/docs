<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D8PMW3CCL2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-D8PMW3CCL2",{})</script>
<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-PV7QFWF",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager --><title data-react-helmet="true">Conflict-Free Replicated Data Types (CRDTs) | Ditto</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.ditto.live/advanced/architecture/crdt"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Conflict-Free Replicated Data Types (CRDTs) | Ditto"><meta data-react-helmet="true" name="description" content="This current page is undergoing extensive updates and edits. Please visit this page frequently for more up-to-date information."><meta data-react-helmet="true" property="og:description" content="This current page is undergoing extensive updates and edits. Please visit this page frequently for more up-to-date information."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.ditto.live/advanced/architecture/crdt"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/advanced/architecture/crdt" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.ditto.live/advanced/architecture/crdt" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.93789a05.css">
<link rel="preload" href="/assets/js/runtime~main.5c0de709.js" as="script">
<link rel="preload" href="/assets/js/main.91efc6a9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="25" height="25"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button><a href="https://ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo.png" alt="Ditto Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.png" alt="Ditto Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Ditto</b></a><a class="navbar__item navbar__link" href="/">Home</a><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Sample Apps</span></a><a href="https://github.com/getditto/docs/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">GitHub Issues</span></a><a href="https://github.com/getditto/docs/discussions" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Discussions</span></a><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Roadmap</span></a><a class="navbar__item navbar__link" href="/changelog">Changelog</a></div><div class="navbar__items navbar__items--right"><a href="https://portal.ditto.live" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span class="inline">Get Started</span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist" href="#">Installation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/installation/javascript">JavaScript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/installation/ios">iOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/installation/android">Android</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/installation/csharp">C#</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/installation/cpp">C++</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/installation/linux">Linux (Raspberry Pi)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/installation/rust">Rust</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Quick Tips</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Advanced</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Platform Permissions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Architecture</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/advanced/architecture/crdt">Conflict-Free Replicated Data Types (CRDTs)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/architecture/mesh-network">Mesh Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/architecture/big-peer-internals">Big Peer Internals</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/supported-platforms">Supported Platforms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/supported-network-transports">Supported Network Transports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/identities">Ditto Identities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/loading-the-javascript-wasm-file">Loading the JavaScript ditto.wasm File</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/manual-network-transport-configuration">Manual Network Transport Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/monitoring-network-transports">Monitoring Transport Conditions</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq">Frequently Asked Questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/changelog">Changelog</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/getditto/docs/issues" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub Issues</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/getditto/docs/discussions/categories/roadmap-and-ideas" target="_blank" rel="noopener noreferrer" class="menu__link"><span>Roadmap</span></a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_2rXS"><div class="docItemContainer_1EXp"><article class="prose max-w-none"><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_Ftrd"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Ditto Delta State CRDT</h1></header><blockquote><p>This current page is undergoing extensive updates and edits. Please visit this page frequently for more up-to-date information. </p></blockquote><p>Ditto&#x27;s data types are based on CRDTs. CRDTs stand for Conflict Free Replicated Data Types.
CRDTs can be updated concurrently by multiple users in a distributed system, without locking or
consensus. Each user edits their own version of the data, and when the versions
are replicated the concurrently edited versions merge together to form a single
version.</p><p>This merged version&#x27;s value is deterministic, which means regardless of the
order that the versions are merged the result is the same. As well as
deterministic we strive to make it unsurprising, and meaningful, in that the
result reflects the input, and some rational interpretation of the input. For
example, if two users set a register to the values &quot;Coca-Cola&quot; and &quot;Pepsi&quot; we
don&#x27;t deterministically resolve all conflicting registers to the value &quot;Sprite&quot;,
but instead pick whichever value of &quot;Coca-Cola&quot; or &quot;Pepsi&quot; was written at the
latest time.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="version-vector">Version Vector<a aria-hidden="true" class="hash-link" href="#version-vector" title="Direct link to heading">â€‹</a></h2><p>The foundation of determining how data should be merged is using a Ditto document&#x27;s version vector.
Each document in each peer contains a hidden metadata map of a <code>Site_ID</code> and a <code>HLC</code>. The HLC stands for a
hybrid logical clock. This <code>HLC</code> is used to determine whether a change has &quot;happened before&quot;.
For more information about the Hybrid Logical Clock, see below.</p><p>Say we have DocumentId: <code>&quot;123abc&quot;</code> on Peer A. </p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W"><pre tabindex="0" class="prism-code language-undefined codeBlock_6upA thin-scrollbar"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#9CDCFE"><span class="token plain">DocumentId: &quot;123abc&quot;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Version Vector: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;A&quot;: 5,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;B&quot;: 1,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;C&quot;: 4</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>The version vector above represents that Peer <code>&quot;A&quot;</code> has incorporated change from other peers <code>&quot;B&quot;</code> and <code>&quot;C&quot;</code> at times <code>1</code> an <code>4</code> respectively.</p><p><em>Disclaimer: Ditto uses a <code>UInt128</code> to represent the <code>Site_ID</code> and <code>64bit timestamp</code> for the <code>HLC</code>. But for educational purposes,
this documentation will often use strings and numbers for readability. Please continue to the Hybrid Logical Clock portion below to learn more.</em></p><p>If an incoming change arrives at Peer <code>&quot;A&quot;</code> with <code>&quot;B&quot;: 4</code>, then Document will merge the incoming data. This is because Peer <code>&quot;A&quot;</code> determined that the document&#x27;s current state has yet not seen the new change. </p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W"><pre tabindex="0" class="prism-code language-undefined codeBlock_6upA thin-scrollbar"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#9CDCFE"><span class="token plain">DocumentId: &quot;123abc&quot;</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">Version Vector: {</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;A&quot;: 5,</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;B&quot;: 1, // ðŸ‘ˆ merge in {&quot;B&quot;: 4} because 4 &gt; 1</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  &quot;C&quot;: 4</span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="types">Types<a aria-hidden="true" class="hash-link" href="#types" title="Direct link to heading">â€‹</a></h2><table><thead><tr><th>Type</th><th>Description</th><th>Merge Semantics</th></tr></thead><tbody><tr><td>Register</td><td>A single primitive value (Number, String, Boolean, Binary File)</td><td>Last (temporal) Write Wins</td></tr><tr><td>Counter</td><td>A special number capable of preserving incrementing and decrementing semantics</td><td>The sum of all site&#x27;s counters</td></tr><tr><td>Array</td><td>An ordered sequence of any of the other types</td><td>Remove wins, updates merge</td></tr><tr><td>Map</td><td>A dictionary of name-&gt;value mappings where name is a string and value is any of the other types</td><td>Remove wins, updates merge</td></tr></tbody></table><p>{.table .table-striped}</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="examples">Examples<a aria-hidden="true" class="hash-link" href="#examples" title="Direct link to heading">â€‹</a></h2><p>The Ditto document is a JSON like document made from a CRDT Map that represents
the JSON Object. The JSON properties are map keys, and the values are any of the
types listed above. One way to think about the types that make up a Ditto
document is like a tree, where there are collections (Array and Map) and leaf
values that are registers or counters.</p><p>The examples below illustrate the merge behaviour of each type with an example
of using the type, and how to reason about concurrent changes.</p><p>Ditto replicates <code>deltas</code> that describe changes to properties of the document. If
a document has 100 named properties, and only the &quot;X&quot; property is changed, only
the metadata and value for the change to the &quot;X&quot; property is replicated. If &quot;X&quot;
is at the end of a path like <code>&quot;a.b.c.y.X = &#x27;foo&#x27;&quot;</code> then the information that
enables other replicas to correctly merge the nested objects that make up the
path to &quot;X&quot; is replicated.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="register">Register<a aria-hidden="true" class="hash-link" href="#register" title="Direct link to heading">â€‹</a></h3><p>A primitive value, a string, or number, or boolean. Ditto uses a temporal
timestamp called an HLC (hybrid logical clock) to associate each register value
with a time. When two registers are merged the value with the highest timestamp
wins.</p><p>Imagine a customer who encounters two attendants, one after the other, in this
case a Last Write Wins register is the perfect data type. For example, one
attendant updates a customer&#x27;s apartment number to &#x27;6&#x27;, and another to apartment
&#x27;9&#x27;. When the two conflicting versions merge, the edit with the highest
timestamp wins.</p><p>In that case that two updates occur at <em>exactly</em> the same time, we use the unique ID of
the Ditto SDK to tie-break, preferring the highest ID.</p><p>In the case of a number like an apartment number, a last-write-wins register is
a good choice, but some numbers represent quantities, and that is when a Counter
is useful.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="counter">Counter<a aria-hidden="true" class="hash-link" href="#counter" title="Direct link to heading">â€‹</a></h3><p>A counter is a number that can be incremented and decremented. In this case we
don&#x27;t want the value with the latest time.</p><p>Imagine a property with 3 entrances, each has a member of staff incrementing a
counter each time a customer enters the location. If we used a last-write-wins
register here the value would alternate between the latest updated value for any
single entrance. Instead a counter merges by taking the sum of each locations
value. Entrance A has seen 100 customer, Entrance B has see 33, and Entrance C
has seen 98. The value of the counter is 100 + 33 + 98 = 231.</p><p>Counters can be decremented too. A word of warning, there is nothing to stop a
counter from going negative. If there is one can of Pepsi left, and two
attendants decrement the Pepsi count by 1 concurrently, the result is -1 Pepsi
cans.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="array">Array<a aria-hidden="true" class="hash-link" href="#array" title="Direct link to heading">â€‹</a></h3><p>An ordered collection of things. The elements of the array can be registers,
counters, maps, even more arrays!</p><p>Elements are added to the array at a position. For example a queue of customer
objects can be inserted into an array. Where two customers are inserted at
position four, after customer <code>X</code>, the merge will use causal information from
the logical clock to decide which element gets the position, and which gets the
following position. The result is deterministic.</p><p>When elements of an array are updated, then the element merges as-per the merge
behaviour of the type at that position in the array.</p><p>Merging works in such a way that we never merge the element with a different
element, even if it moves. If some element&#x27;s position has changed (due to
insertions or removes) at one device, we ensure to merge that element with it&#x27;s
corresponding version in the other devices.</p><p>When an element is removed from the array, a tombstone is recorded, ensuring
that if there is an update concurrent with the remove the remove wins.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="map">Map<a aria-hidden="true" class="hash-link" href="#map" title="Direct link to heading">â€‹</a></h3><p>The map represents a JSON like object, and it is the basis of the Ditto Document.
Whenever you create a document you are creating a CRDT Map at its root. We nest maps within
maps to allow complex JSON like document structures. A map is made up of
properties and values. The values can be registers, counter, arrays, or maps.</p><p>Maps merge with a remove-wins semantic. This means if some property of the map
is concurrently updated and removed, the remove wins. The values of map
properties merge using the correct method of their type.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="type-conflicts">Type Conflicts<a aria-hidden="true" class="hash-link" href="#type-conflicts" title="Direct link to heading">â€‹</a></h4><p>One unique problem for Maps is that it is possible for one device to create a
document where some property is a map, and another device creates the same
document where that property is an array. For example:</p><p>Site A creates:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W json"><pre tabindex="0" class="prism-code language-json codeBlock_6upA thin-scrollbar"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Bob Jones&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token property">&quot;address&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token property">&quot;street&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Long Road&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token property">&quot;house number&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">10298</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token property">&quot;zip&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;90210&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>Whilst Site B creates:</p><div class="codeBlockContainer_2gih"><div class="codeBlockContent_3z4W json"><pre tabindex="0" class="prism-code language-json codeBlock_6upA thin-scrollbar"><code class="codeBlockLines_xlV7"><span class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Bob Jones&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token property">&quot;address&quot;</span><span class="token operator" style="color:rgb(212, 212, 212)">:</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token number" style="color:rgb(181, 206, 168)">10298</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Long Road&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;90210&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i clean-btn"><div><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4 inline mr-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg><span class="text-xs">Copy</span></div></button></div></div><p>In this instance we cannot merge an array with an object. We chose not to let
the &quot;last updated type&quot; win, as this could lead to a ping-pong of type changes
between the devices. Instead we keep BOTH values for the the &quot;address&quot; property.
We render only the last updated type when we show JSON, but we also provide a
way for the programmer to chose which type to render for a property, or to
render ALL types for a property. This way we can manage type level conflict, and
allow different versions of an application that use different implicit schema to
co-exist.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="hybrid-logical-clock">Hybrid Logical Clock<a aria-hidden="true" class="hash-link" href="#hybrid-logical-clock" title="Direct link to heading">â€‹</a></h2><p>It might be tempting to use physical clocks to resolve conflicts when attempting to merge concurrent data changes. However, it&#x27;s essential to know that even quartz-crystal-based physical clocks can skew forwards or backward in time. Almost every device regularly attempts to synchronize with an NTP-synchronized clock server. But even then, the round trip time from the request to the server&#x27;s response adds additional variability. In addition, there are limitations to nature and physics that will never allow two measurements of physical time to align precisely. Thus, these conditions led us to determine that physical clocks were not reliable in a distributed mesh network. </p><p>Each Ditto document includes a version vector. The replication system uses the version vector to capture local and observed edits from other peers. When a peer incorporates changes from other peers, the local peer can use the incoming remote peer&#x27;s version vectors to determine whether the changes are new or old. In other words, a peer can distinguish from other peer&#x27;s incoming version vectors if the incoming data has &quot;happened before&quot; or not.</p><p>Although we decided that we could not build a system that resolved conflicts based purely on physical time, we needed to preserve the notion of physical time as not to confuse users of collaborative applications. However, each peer still needs a deterministic way to resolve conflicts. In other words, each peer when sharing CRDT deltas needs to always resolve conflicts exactly the same way. This requirement still needs <em>logical</em> ordering. This requirement led us to implement the version vector with a Hybrid Logical Clock (often referred to as HLC).</p><p>In Ditto&#x27;s distributed system, the HLC is a 64-bit timestamp comprised of 48 bits of a physical timestamp and 16 bits of a monotonically increasing logical clock.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/getditto/docs/edit/master/docs/advanced/architecture/crdt.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/advanced/platform-permissions/android-platform-permissions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Android</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/advanced/architecture/mesh-network"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mesh Network<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#version-vector" class="table-of-contents__link toc-highlight">Version Vector</a></li><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#register" class="table-of-contents__link toc-highlight">Register</a></li><li><a href="#counter" class="table-of-contents__link toc-highlight">Counter</a></li><li><a href="#array" class="table-of-contents__link toc-highlight">Array</a></li><li><a href="#map" class="table-of-contents__link toc-highlight">Map</a></li></ul></li><li><a href="#hybrid-logical-clock" class="table-of-contents__link toc-highlight">Hybrid Logical Clock</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Quick Start</a></li><li class="footer__item"><a href="https://www.ditto.live/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Main Website</span></a></li><li class="footer__item"><a href="https://github.com/getditto/samples" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Samples Apps</span></a></li><li class="footer__item"><a class="footer__link-item" href="/changelog">Changelog</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/getditto/docs/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Discussions</span></a></li><li class="footer__item"><a href="https://github.com/getditto/docs/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub Issues</span></a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/ditto" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow</span></a></li><li class="footer__item"><a href="https://twitter.com/dittolive" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter</span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 DittoLive, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5c0de709.js"></script>
<script src="/assets/js/main.91efc6a9.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PV7QFWF" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>